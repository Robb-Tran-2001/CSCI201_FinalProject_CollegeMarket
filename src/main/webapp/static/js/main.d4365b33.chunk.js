(this["webpackJsonpcollege-marketplace"]=this["webpackJsonpcollege-marketplace"]||[]).push([[0],{170:function(e,t,a){e.exports=a(291)},178:function(e,t){},180:function(e,t){},213:function(e,t){},214:function(e,t){},284:function(e,t,a){},291:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(18),c=a.n(l),s=a(17),o=a(303),i=a(163),u=a(10),m=a(42),d=a(49),p=a(81),E=a(300),f=a(301),h=a(295),b=a(67),g="ws://"+window.location.host+"/marketplace-service/api/push/",y=function(e){var t=e.show,a=e.handleClose,l=e.updateUser,c=Object(n.useState)(!0),o=Object(s.a)(c,2),i=o[0],u=o[1],m=Object(n.useState)({}),g=Object(s.a)(m,2),y=g[0],O=g[1],v=Object(n.useState)(!1),S=Object(s.a)(v,2),j=S[0],w=S[1];return r.a.createElement(E.a,{show:t,onHide:a},r.a.createElement(E.a.Header,null,i?"Log in":"Sign up"),r.a.createElement(E.a.Body,null,r.a.createElement(f.a,{onChange:function(e){O(Object(p.a)({},y,Object(d.a)({},e.target.name,e.target.value)))},onSubmit:function(e){if(e.preventDefault(),e.stopPropagation(),!0===e.currentTarget.checkValidity()){w(!0);var t={username:y.username},n=Object(b.SHA256)(y.username+":"+y.password).toString();t.hash=n,console.info("POST",i?"api/login":"api/signup",t),fetch(i?"api/login":"api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){200===e.status?(l(y.username),sessionStorage.setItem("username",y.username),w(!1),a()):(alert("Invalid email/password!"),w(!1))}))}}},r.a.createElement(f.a.Group,{controlId:"email"},r.a.createElement(f.a.Label,null,"Username"),r.a.createElement(f.a.Control,{required:!0,name:"username",type:"text",placeholder:"Username"})),r.a.createElement(f.a.Group,{controlId:"password"},r.a.createElement(f.a.Label,null,"Password"),r.a.createElement(f.a.Control,{required:!0,name:"password",type:"password",placeholder:"Password"})),r.a.createElement(f.a.Row,{style:{alignItems:"center"}},r.a.createElement(h.a,{className:"mr-auto ml-1",variant:"primary",type:"submit",disabled:j},j?"Processing...":"Submit"),r.a.createElement("i",{className:"mr-1",style:{cursor:"pointer"},onClick:function(){return u(!i)}},r.a.createElement("u",null,i?"Don't have an account?":"Have an account?"))))))},O=function(e){var t=e.username,a=e.updateUser,l=Object(n.useState)(!1),c=Object(s.a)(l,2),d=c[0],p=c[1],E=Object(u.e)();return r.a.createElement(r.a.Fragment,null,r.a.createElement(o.a,{bg:"primary",position:"static",variant:"dark",expand:!0},r.a.createElement(i.a,{md:3},r.a.createElement(o.a.Brand,{as:m.b,to:"/",className:"mr-auto"},"USC Marketplace")),r.a.createElement(i.a,{md:6}),r.a.createElement(i.a,{md:3,style:{textAlign:"right"}},r.a.createElement(o.a.Text,{onClick:function(){t?E.push("/user"):p(!0)},style:{cursor:"pointer"}},t||"Log in"))),r.a.createElement(y,{show:d,handleClose:function(){return p(!1)},updateUser:a}))},v=(a(284),a(71)),S=a(304),j=a(305),w=a(296),C=a(297),P=a(298),T=function(e){var t=e.username,a=e.searchitems,l=Object(n.useState)(a||[]),c=Object(s.a)(l,2),o=c[0],i=c[1],u=Object(n.useState)(1),d=Object(s.a)(u,2),p=d[0],E=d[1];Object(n.useEffect)((function(){a||(console.info("GET api/items"),fetch("api/items").then((function(e){return e.json()})).then((function(e){return i(e)})))}),[]);var f=function(e){E(e),window.scrollTo(0,0)},b=o&&o.slice(20*(p-1),20*p).map((function(e){return r.a.createElement("tr",{key:e.itemid},r.a.createElement(S.a,{trigger:"hover",placement:"auto-start",overlay:r.a.createElement(j.a,null,r.a.createElement(j.a.Content,null,e.description))},r.a.createElement("td",{style:{width:"50%"}},e.name)),r.a.createElement("td",{style:{width:"20%"}},"$",e.price),r.a.createElement("td",{style:{width:"20%"}},e.seller),r.a.createElement("td",{style:{width:"10%"}},r.a.createElement(h.a,{onClick:function(){return a=e.itemid,console.info("POST api/buy",{itemid:a,username:t}),void fetch("api/buy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemid:a,username:t})}).then((function(e){200===e.status?alert("Successful. Waiting for seller approval now."):alert("Item is not available.")}));var a},disabled:!t},"Buy now")))}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{fluid:"lg",className:"my-5"},t?r.a.createElement(h.a,{as:m.b,to:"/create",className:"mb-3"},"Create new listing"):"",0!==o.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(C.a,{hover:!0},r.a.createElement("thead",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Price"),r.a.createElement("th",null,"Seller"),r.a.createElement("th",null)),r.a.createElement("tbody",null,b)),1!==p?r.a.createElement(h.a,{onClick:function(){return f(p-1)},className:"mr-3"},"Previous"):"",p!==Math.ceil(o.length/20)?r.a.createElement(h.a,{onClick:function(){return f(p+1)}},"Next"):""):r.a.createElement(P.a,{animation:"border",variant:"primary",className:"loading-spinner"})))},k=a(118),N=a(299),I=a(302),x=function(e){var t=e.username,a=Object(n.useState)("orders"),l=Object(s.a)(a,2),c=l[0],o=l[1],u=Object(n.useState)([]),m=Object(s.a)(u,2),d=m[0],p=m[1];Object(n.useEffect)((function(){console.info("GET","api/user/"+t),fetch("api/user/"+t).then((function(e){return e.json()})).then((function(e){p(e)}))}),[t]);var E;return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{className:"mt-5"},r.a.createElement(i.a,{md:{span:2,offset:1}},r.a.createElement(I.a,{variant:"pills",defaultActiveKey:"orders",className:"flex-column",onSelect:function(e){return o(e)}},r.a.createElement(I.a.Item,null,r.a.createElement(I.a.Link,{eventKey:"orders"},"Requests")),r.a.createElement(I.a.Item,null,r.a.createElement(I.a.Link,{eventKey:"password"},"Change password")))),r.a.createElement(i.a,{md:{span:6},className:"ml-5"},"password"===c?r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Change password"),r.a.createElement(f.a,{onSubmit:function(e){e.preventDefault(),e.stopPropagation();var a=new FormData(e.target);""!==a.get("password").trim()?(console.info("POST","api/user/password",{username:t,hash:Object(b.SHA256)(t+":"+a.get("password")).toString()}),fetch("api/user/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,hash:Object(b.SHA256)(t+":"+a.get("password")).toString()})}).then((function(e){200===e.status?alert("Password changed successfully!"):alert("An error has occured! Please try again.")}))):alert("Please enter a valid password")}},r.a.createElement(f.a.Group,{controlId:"name"},r.a.createElement(f.a.Label,null,"Username"),r.a.createElement(f.a.Control,{type:"text",placeholder:"Enter your name",defaultValue:t,disabled:!0})),r.a.createElement(f.a.Group,{controlId:"password"},r.a.createElement(f.a.Label,null,"Password"),r.a.createElement(f.a.Control,{type:"password",placeholder:"Password",name:"password"})),r.a.createElement(h.a,{variant:"primary",type:"submit"},"Save changes"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Incoming Requests"),r.a.createElement(C.a,null,r.a.createElement("thead",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Price"),r.a.createElement("th",null,"Buyer"),r.a.createElement("th",null,"Status")),r.a.createElement("tbody",null,(E=d)&&E.map((function(e){return r.a.createElement("tr",{key:e.itemid},r.a.createElement("td",null,e.name),r.a.createElement("td",null,"$",e.price),r.a.createElement("td",null,e.buyer),r.a.createElement("td",null,r.a.createElement(h.a,{onClick:function(){return function(e){console.info("POST","api/user/approve",{username:t,itemid:e.itemid}),fetch("api/user/approve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({seller:t,buyer:e.buyer,itemid:e.itemid})}).then((function(t){if(200===t.status){alert("Successful");var a=d.findIndex((function(t){return t.itemid===e.itemid}));p([].concat(Object(k.a)(d.slice(0,a)),Object(k.a)(d.slice(a+1))))}else alert("An error has occured.")}))}(e)}},"Approve")))}))))))))},L=function(e){var t=e.username,a=Object(n.useState)({}),l=Object(s.a)(a,2),c=l[0],o=l[1],i=Object(n.useState)(!1),m=Object(s.a)(i,2),E=m[0],b=m[1],g=Object(u.e)();return r.a.createElement(w.a,{fluid:"md",className:"mt-4"},r.a.createElement("h2",null,"Create new listing"),r.a.createElement(f.a,{onChange:function(e){o(Object(p.a)({},c,Object(d.a)({},e.target.name,e.target.value)))},onSubmit:function(e){e.preventDefault(),e.stopPropagation(),e.currentTarget.checkValidity()&&(b(!0),console.info("POST","api/create",c),fetch("api/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then((function(e){200===e.status?(alert("Successful"),g.push("/")):alert("An error has occured."),b(!1)})))}},r.a.createElement(f.a.Group,{controlId:"title"},r.a.createElement(f.a.Label,null,"Title"),r.a.createElement(f.a.Control,{type:"text",name:"title",required:!0})),r.a.createElement(f.a.Group,{controlId:"price"},r.a.createElement(f.a.Label,null,"Price"),r.a.createElement(f.a.Control,{type:"number",name:"price",required:!0})),r.a.createElement(f.a.Group,{controlId:"description"},r.a.createElement(f.a.Label,null,"Description"),r.a.createElement(f.a.Control,{as:"textarea",rows:5,name:"description",required:!0})),r.a.createElement("input",{type:"hidden",name:"username",value:t}),r.a.createElement(h.a,{type:"submit",disabled:E},"Submit")))};new FormData;var A=function(e){var t=e.username,a=Object(u.f)();return r.a.createElement(v.a,{className:"p-0"},t&&r.a.createElement(v.a,null,r.a.createElement(u.a,{path:"/user"},r.a.createElement(x,{username:t})),r.a.createElement(u.a,{path:"/create"},r.a.createElement(L,{username:t}))),a.state?r.a.createElement(T,{username:t,searchitems:a.state}):r.a.createElement(u.a,{path:"/",exact:!0},r.a.createElement(T,{username:t})))},G=a(89);var F=function(){var e=Object(G.useToasts)().addToast,t=Object(n.useState)(null),a=Object(s.a)(t,2),l=a[0],c=a[1];return Object(n.useEffect)((function(){var e=sessionStorage.getItem("username");e!==l&&c(e)}),[]),Object(n.useEffect)((function(){if(l){console.info("Connecting to push"),console.info(g);var t=new WebSocket(g+l);return t.onmessage=function(t){var a=JSON.parse(t.data),n=a.buyer+"just bought"+a.item+"!";e(n,{appearance:"info"})},function(){t.close()}}}),[l,e]),r.a.createElement(m.a,{basename:"/marketplace-service"},r.a.createElement(O,{username:l,updateUser:function(e){return c(e)}}),r.a.createElement(A,{username:l}))};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(G.ToastProvider,null,r.a.createElement(F,null))),document.getElementById("root"))}},[[170,1,2]]]);
//# sourceMappingURL=main.d4365b33.chunk.js.map