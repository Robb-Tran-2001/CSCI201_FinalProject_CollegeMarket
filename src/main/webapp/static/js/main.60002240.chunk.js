(this["webpackJsonpcollege-marketplace"]=this["webpackJsonpcollege-marketplace"]||[]).push([[0],{169:function(e,t,a){e.exports=a(289)},177:function(e,t){},179:function(e,t){},212:function(e,t){},213:function(e,t){},283:function(e,t,a){},289:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(24),c=a.n(l),o=a(10),i=a(298),s=a(162),u=a(295),m=a(161),p=a(163),d=a(11),E=a(40),f=a(47),b=a(63),h=a(294),g=a(64),y="ws://"+window.location.host+"/marketplace-service/api/push/",O=function(e){var t=e.show,a=e.handleClose,l=e.updateUser,c=Object(n.useState)(!0),i=Object(o.a)(c,2),s=i[0],m=i[1],d=Object(n.useState)({}),E=Object(o.a)(d,2),y=E[0],O=E[1],v=Object(n.useState)(!1),j=Object(o.a)(v,2),S=j[0],w=j[1];return r.a.createElement(h.a,{show:t,onHide:a},r.a.createElement(h.a.Header,null,s?"Log in":"Sign up"),r.a.createElement(h.a.Body,null,r.a.createElement(u.a,{onChange:function(e){O(Object(b.a)({},y,Object(f.a)({},e.target.name,e.target.value)))},onSubmit:function(e){if(e.preventDefault(),e.stopPropagation(),!0===e.currentTarget.checkValidity()){w(!0);var t={username:y.username},n=Object(g.SHA256)(y.username+":"+y.password).toString();t.hash=n,console.info("POST",s?"api/login":"api/signup",t),fetch(s?"api/login":"api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){200===e.status?(l(y.username),sessionStorage.setItem("username",y.username),w(!1),a()):(alert("Invalid email/password!"),w(!1))}))}}},r.a.createElement(u.a.Group,{controlId:"email"},r.a.createElement(u.a.Label,null,"Username"),r.a.createElement(u.a.Control,{required:!0,name:"username",type:"text",placeholder:"Username"})),r.a.createElement(u.a.Group,{controlId:"password"},r.a.createElement(u.a.Label,null,"Password"),r.a.createElement(u.a.Control,{required:!0,name:"password",type:"password",placeholder:"Password"})),r.a.createElement(u.a.Row,{style:{alignItems:"center"}},r.a.createElement(p.a,{className:"mr-auto ml-1",variant:"primary",type:"submit",disabled:S},S?"Processing...":"Submit"),r.a.createElement("i",{className:"mr-1",style:{cursor:"pointer"},onClick:function(){return m(!s)}},r.a.createElement("u",null,s?"Don't have an account?":"Have an account?"))))))},v=function(e){var t=e.username,a=e.updateUser,l=Object(n.useState)(!1),c=Object(o.a)(l,2),f=c[0],b=c[1],h=Object(n.useState)(""),g=Object(o.a)(h,2),y=g[0],v=g[1],j=Object(d.e)();return r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,{bg:"primary",position:"static",variant:"dark",expand:!0},r.a.createElement(s.a,{md:3},r.a.createElement(i.a.Brand,{as:E.b,to:"/",className:"mr-auto"},"USC Marketplace")),r.a.createElement(s.a,{md:6},r.a.createElement(u.a,{inline:!0,className:"",onSubmit:function(e){e.preventDefault(),e.stopPropagation(),""!==y.trim()&&(console.info("GET api/search?q="+y.trim().replace(" ","%20")),fetch("api/search?q="+y.trim().replace(" ","%20")).then((function(e){return e.json()})).then((function(e){0!==e.length?j.push("/",e):alert("No results found!")})))}},r.a.createElement(m.a,{type:"text",style:{width:"90%",marginRight:"-5px"},placeholder:"Search",onChange:function(e){return v(e.target.value)}}),r.a.createElement(p.a,{variant:"primary",type:"submit",style:{width:"10%",marginLeft:"-5px",borderRadius:"0px"}},r.a.createElement("ion-icon",{name:"search-outline"})))),r.a.createElement(s.a,{md:3,style:{textAlign:"right"}},r.a.createElement(i.a.Text,{onClick:function(){t?j.push("/user"):b(!0)},style:{cursor:"pointer"}},t||"Log in"))),r.a.createElement(O,{show:f,handleClose:function(){return b(!1)},updateUser:a}))},j=(a(283),a(67)),S=a(290),w=a(291),C=a(292),T=a(68),P=function(e){var t=e.username,a=e.item,l=e.handleClick,c=Object(n.useState)(!1),i=Object(o.a)(c,2),s=i[0],u=i[1],m=Object(n.useState)(!1),d=Object(o.a)(m,2),E=d[0],f=d[1];return r.a.createElement(T.a,{style:{marginTop:30,marginLeft:15,marginRight:15,cursor:"pointer"},onClick:function(){return l(a.itemid)},onMouseEnter:function(){return u(!0)},onMouseLeave:function(){return u(!1)}},r.a.createElement("div",{className:"square",style:{backgroundImage:"url(".concat(a.pic,")")}},t?r.a.createElement("div",{className:"cardImageOverlay"},s?r.a.createElement(p.a,{style:{position:"absolute",top:0,right:0,borderRadius:10,marginTop:5,marginRight:5},onClick:function(e){e.stopPropagation(),f(!0),console.info("POST api/buy",{itemid:a.itemid,username:t}),fetch("api/buy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemid:a.itemid,username:t})}).then((function(e){200===e.status?alert("Successful. Waiting for seller approval now."):alert("Item is not available.")}))},disabled:E},E?"Requested":"Buy"):""):""),r.a.createElement(T.a.Body,null,r.a.createElement(T.a.Title,{style:{marginTop:10}},"$",a.price),r.a.createElement(T.a.Text,{style:{marginBottom:10}},a.name)))},k=a(297),N=function(e){var t=e.username,a=e.itemid,l=e.close,c=Object(n.useState)(!1),i=Object(o.a)(c,2),u=i[0],m=i[1],d=Object(n.useState)(null),E=Object(o.a)(d,2),f=E[0],b=E[1],g=Object(n.useState)(!1),y=Object(o.a)(g,2),O=y[0],v=y[1],j=f&&f.image.map((function(e,t){return r.a.createElement(k.a.Item,{key:t},r.a.createElement("img",{className:"d-block w-100",src:e,alt:t}))})),T=function(){return r.a.createElement("div",{className:"modal-close-button",onClick:l},r.a.createElement("ion-icon",{style:{fontSize:64},name:"close-outline"}))};return Object(n.useEffect)((function(){-1!==a&&(console.info("GET api/item/"+a),fetch("api/item/"+a).then((function(e){return e.json()})).then((function(e){b(e),m(!0),v(""!==e.buyerid)}),(function(e){alert("Loading failed",e),l()})))}),[a,l]),r.a.createElement(h.a,{show:-1!==a,onHide:l,animation:!1,dialogAs:"div"},r.a.createElement(T,null),u?r.a.createElement(S.a,{fluid:!0},r.a.createElement(w.a,null,r.a.createElement(s.a,{md:8},r.a.createElement(k.a,{interval:null,slide:!1,className:"carousel-container"},j)),r.a.createElement(s.a,{md:4},r.a.createElement(S.a,{fluid:!0,className:"desc-container"},r.a.createElement("h2",null,r.a.createElement("b",null,f.name)),r.a.createElement("h4",null,"$",f.price),r.a.createElement("br",null),r.a.createElement("h5",null,r.a.createElement("b",null,"Details")),r.a.createElement("p",null,f.description),r.a.createElement("br",null),r.a.createElement("h5",null,r.a.createElement("b",null,"Seller")),r.a.createElement("p",null,r.a.createElement("b",null,f.seller)),t?r.a.createElement(p.a,{className:"buy-button",disabled:O,onClick:function(e){e.stopPropagation(),v(!0),console.info("POST api/buy",{itemid:f.itemid,username:t}),fetch("api/buy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemid:f.itemid,username:t})}).then((function(e){200===e.status?alert("Successful. Waiting for seller approval now."):alert("Item is not available.")}))}},O?"Pending":"Buy now"):r.a.createElement(p.a,{disabled:!0,className:"buy-button"},"Log in to buy"))))):r.a.createElement(C.a,{animation:"border",variant:"primary",className:"loading-spinner"}))},I=function(e){var t=e.username,a=e.searchitems,l=Object(n.useState)(-1),c=Object(o.a)(l,2),i=c[0],u=c[1],m=Object(n.useState)(a||[]),d=Object(o.a)(m,2),f=d[0],b=d[1],h=Object(n.useState)(1),g=Object(o.a)(h,2),y=g[0],O=g[1],v=function(e){u(e)};Object(n.useEffect)((function(){a||(console.info("GET api/items"),fetch("api/items").then((function(e){return e.json()})).then((function(e){return b(e)})))}),[]);var j=Object(n.useCallback)((function(){u(-1)}),[]),T=function(e){O(e),window.scrollTo(0,0)},k=f&&f.slice(20*(y-1),20*y).map((function(e){return r.a.createElement(s.a,{key:y+"."+e.itemid},r.a.createElement(P,{username:t,item:e,handleClick:v}))}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(S.a,{fluid:"lg",className:"my-4"},t?r.a.createElement(p.a,{as:E.b,to:"/create"},"Create new listing"):"",0!==f.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{xs:2,md:4},k),1!==y?r.a.createElement(p.a,{onClick:function(){return T(y-1)},className:"mr-3"},"Previous"):"",y!==Math.ceil(f.length/20)?r.a.createElement(p.a,{onClick:function(){return T(y+1)}},"Next"):""):r.a.createElement(C.a,{animation:"border",variant:"primary",className:"loading-spinner"})),r.a.createElement(N,{username:t,itemid:i,close:j}))},x=a(112),L=a(296),q=a(293),G=function(e){var t=e.username,a=Object(n.useState)("orders"),l=Object(o.a)(a,2),c=l[0],i=l[1],m=Object(n.useState)([]),d=Object(o.a)(m,2),E=d[0],f=d[1];Object(n.useEffect)((function(){console.info("GET","api/user/"+t),fetch("api/user/"+t).then((function(e){return e.json()})).then((function(e){f(e)}))}),[t]);var b;return r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{className:"mt-5"},r.a.createElement(s.a,{md:{span:2,offset:1}},r.a.createElement(L.a,{variant:"pills",defaultActiveKey:"orders",className:"flex-column",onSelect:function(e){return i(e)}},r.a.createElement(L.a.Item,null,r.a.createElement(L.a.Link,{eventKey:"orders"},"Requests")),r.a.createElement(L.a.Item,null,r.a.createElement(L.a.Link,{eventKey:"password"},"Change password")))),r.a.createElement(s.a,{md:{span:6},className:"ml-5"},"password"===c?r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Change password"),r.a.createElement(u.a,{onSubmit:function(e){e.preventDefault(),e.stopPropagation();var a=new FormData(e.target);""!==a.get("password").trim()?(console.info("POST","api/user/password",{username:t,hash:Object(g.SHA256)(t+":"+a.get("password")).toString()}),fetch("api/user/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,hash:Object(g.SHA256)(t+":"+a.get("password")).toString()})}).then((function(e){200===e.status?alert("Password changed successfully!"):alert("An error has occured! Please try again.")}))):alert("Please enter a valid password")}},r.a.createElement(u.a.Group,{controlId:"name"},r.a.createElement(u.a.Label,null,"Username"),r.a.createElement(u.a.Control,{type:"text",placeholder:"Enter your name",defaultValue:t,disabled:!0})),r.a.createElement(u.a.Group,{controlId:"password"},r.a.createElement(u.a.Label,null,"Password"),r.a.createElement(u.a.Control,{type:"password",placeholder:"Password",name:"password"})),r.a.createElement(p.a,{variant:"primary",type:"submit"},"Save changes"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Incoming Requests"),r.a.createElement(q.a,null,r.a.createElement("thead",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Price"),r.a.createElement("th",null,"Buyer"),r.a.createElement("th",null,"Status")),r.a.createElement("tbody",null,(b=E)&&b.map((function(e){return r.a.createElement("tr",{key:e.itemid},r.a.createElement("td",null,e.name),r.a.createElement("td",null,"$",e.price),r.a.createElement("td",null,e.buyer),r.a.createElement("td",null,r.a.createElement(p.a,{onClick:function(){return a=e.itemid,console.info("POST","api/user/approve",{username:t,itemid:a}),void fetch("api/user/approve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,itemid:a})}).then((function(e){if(200===e.status){alert("Successful");var t=E.findIndex((function(e){return e.itemid===a}));f([].concat(Object(x.a)(E.slice(0,t)),Object(x.a)(E.slice(t+1))))}else alert("An error has occured.")}));var a}},"Approve")))}))))))))},A=a(167),D=function(e){var t=e.username,a=Object(n.useState)({}),l=Object(o.a)(a,2),c=l[0],i=l[1],s=Object(n.useState)(!1),m=Object(o.a)(s,2),E=m[0],h=m[1],g=Object(d.e)();return r.a.createElement(S.a,{fluid:"md",className:"mt-4"},r.a.createElement("h2",null,"Create new listing"),r.a.createElement(u.a,{onChange:function(e){"picture"===e.target.name?i(Object(b.a)({},c,{pictures:e.target.files})):i(Object(b.a)({},c,Object(f.a)({},e.target.name,e.target.value)))},onSubmit:function(e){if(e.preventDefault(),e.stopPropagation(),e.currentTarget.checkValidity()&&function(){var e=/[a-zA-Z0-9]+\.(jpg|png|jpeg)$/i;console.log(c.pictures);for(var t=0;t<c.pictures.length;t++)if(!e.test(c.pictures[t].name))return alert("Please upload valid pictures!"),!1;return!0}()){h(!0);var t=new FormData(e.target);console.info("POST","api/create");var a,n=Object(A.a)(t.entries());try{for(n.s();!(a=n.n()).done;){var r=a.value;console.log(r[0]+" - "+r[1])}}catch(l){n.e(l)}finally{n.f()}fetch("api/create",{method:"POST",headers:{"Content-Type":"multipart/formdata"},body:t}).then((function(e){200===e.status?g.push("/"):alert("An error has occured."),h(!1)}))}}},r.a.createElement(u.a.Group,{controlId:"title"},r.a.createElement(u.a.Label,null,"Title"),r.a.createElement(u.a.Control,{type:"text",name:"title",required:!0})),r.a.createElement(u.a.Group,{controlId:"price"},r.a.createElement(u.a.Label,null,"Price"),r.a.createElement(u.a.Control,{type:"number",name:"price",required:!0})),r.a.createElement(u.a.Group,{controlId:"picture"},r.a.createElement(u.a.File,{name:"picture",multiple:!0,required:!0,label:"Pictures"})),r.a.createElement(u.a.Group,{controlId:"description"},r.a.createElement(u.a.Label,null,"Description"),r.a.createElement(u.a.Control,{as:"textarea",rows:5,name:"description",required:!0})),r.a.createElement("input",{type:"hidden",name:"username",value:t}),r.a.createElement(p.a,{type:"submit",disabled:E},"Submit")))};new FormData;var F=function(e){var t=e.username,a=Object(d.f)();return r.a.createElement(j.a,{className:"p-0"},t&&r.a.createElement(j.a,null,r.a.createElement(d.a,{path:"/user"},r.a.createElement(G,{username:t})),r.a.createElement(d.a,{path:"/create"},r.a.createElement(D,{username:t}))),a.state?r.a.createElement(I,{username:t,searchitems:a.state}):r.a.createElement(d.a,{path:"/",exact:!0},r.a.createElement(I,{username:t})))},R=a(82);var B=function(){var e=Object(R.useToasts)().addToast,t=Object(n.useState)(null),a=Object(o.a)(t,2),l=a[0],c=a[1];return Object(n.useEffect)((function(){var e=sessionStorage.getItem("username");e!==l&&c(e)}),[]),Object(n.useEffect)((function(){if(l){console.info("Connecting to push"),console.info(y);var t=new WebSocket(y+l);return t.onmessage=function(t){var a=JSON.parse(t.data),n=a.buyer+"just bought"+a.item+"!";e(n,{appearance:"info"})},function(){t.close()}}}),[l,e]),r.a.createElement(E.a,{basename:"/marketplace-service"},r.a.createElement(v,{username:l,updateUser:function(e){return c(e)}}),r.a.createElement(F,{username:l}))};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(R.ToastProvider,null,r.a.createElement(B,null))),document.getElementById("root"))}},[[169,1,2]]]);
//# sourceMappingURL=main.60002240.chunk.js.map