(this["webpackJsonpcollege-marketplace"]=this["webpackJsonpcollege-marketplace"]||[]).push([[0],{203:function(e,t,a){e.exports=a(357)},211:function(e,t){},213:function(e,t){},245:function(e,t){},246:function(e,t){},316:function(e,t,a){},357:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(20),c=a.n(l),s=a(14),o=a(369),u=a(194),m=a(11),i=a(46),d=a(47),p=a(62),E=a(366),f=a(367),b=a(361),h=a(92),g=(window.location.host,function(e){var t=e.show,a=e.handleClose,l=e.updateUser,c=Object(n.useState)(!0),o=Object(s.a)(c,2),u=o[0],m=o[1],i=Object(n.useState)({}),g=Object(s.a)(i,2),y=g[0],O=g[1],j=Object(n.useState)(!1),v=Object(s.a)(j,2),S=v[0],w=v[1];return r.a.createElement(E.a,{show:t,onHide:a},r.a.createElement(E.a.Header,null,u?"Log in":"Sign up"),r.a.createElement(E.a.Body,null,r.a.createElement(f.a,{onChange:function(e){O(Object(p.a)({},y,Object(d.a)({},e.target.name,e.target.value)))},onSubmit:function(e){if(e.preventDefault(),e.stopPropagation(),!0===e.currentTarget.checkValidity()){w(!0);var t={name:y.username},n=Object(h.SHA256)(y.username+":"+y.password).toString();t.password=n,fetch(u?"api/user/login":"api/user/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){200===e.status?(l(y.username),w(!1),a()):(u?alert("Invalid email/password!"):alert("User already exists!"),w(!1))}))}}},r.a.createElement(f.a.Group,{controlId:"email"},r.a.createElement(f.a.Label,null,"Username"),r.a.createElement(f.a.Control,{required:!0,name:"username",type:"text",placeholder:"Username"})),r.a.createElement(f.a.Group,{controlId:"password"},r.a.createElement(f.a.Label,null,"Password"),r.a.createElement(f.a.Control,{required:!0,name:"password",type:"password",placeholder:"Password"})),r.a.createElement(f.a.Row,{style:{alignItems:"center"}},r.a.createElement(b.a,{className:"mr-auto ml-1",variant:"primary",type:"submit",disabled:S},S?"Processing...":"Submit"),r.a.createElement("i",{className:"mr-1",style:{cursor:"pointer"},onClick:function(){return m(!u)}},r.a.createElement("u",null,u?"Don't have an account?":"Have an account?"))))))}),y=function(e){var t=e.username,a=e.updateUser,l=Object(n.useState)(!1),c=Object(s.a)(l,2),d=c[0],p=c[1],E=Object(m.e)();return r.a.createElement(r.a.Fragment,null,r.a.createElement(o.a,{bg:"primary",position:"static",variant:"dark",expand:!0},r.a.createElement(u.a,{md:3},r.a.createElement(o.a.Brand,{as:i.b,to:"/",className:"mr-auto"},"USC Marketplace")),r.a.createElement(u.a,{md:6}),r.a.createElement(u.a,{md:3,style:{textAlign:"right"}},r.a.createElement(o.a.Text,{onClick:function(){t?E.push("/user"):p(!0)},style:{cursor:"pointer"}},t||"Log in"))),r.a.createElement(g,{show:d,handleClose:function(){return p(!1)},updateUser:a}))},O=(a(316),a(80)),j=a(370),v=a(371),S=a(362),w=a(363),C=a(364),N=function(e){var t=e.username,a=e.searchitems,l=Object(n.useState)(a||[]),c=Object(s.a)(l,2),o=c[0],u=c[1],m=Object(n.useState)(1),d=Object(s.a)(m,2),p=d[0],E=d[1],f=Object(n.useState)(!1),h=Object(s.a)(f,2),g=h[0],y=h[1];Object(n.useEffect)((function(){if(!a){var e=sessionStorage.getItem("username")?"?name="+sessionStorage.getItem("username"):"";fetch("api/items"+e).then((function(e){return e.json()})).then((function(e){y(!0),u(e.filter((function(e){return e.sellerName!==t})))}))}}),[t]);var O=function(e){E(e),window.scrollTo(0,0)},N=o&&o.slice(20*(p-1),20*p).map((function(e){return r.a.createElement("tr",{key:e.itemid},r.a.createElement(j.a,{trigger:"hover",placement:"auto-start",overlay:r.a.createElement(v.a,null,r.a.createElement(v.a.Content,null,e.description))},r.a.createElement("td",{style:{width:"50%"}},e.name)),r.a.createElement("td",{style:{width:"20%"}},"$",e.price),r.a.createElement("td",{style:{width:"20%"}},e.sellerName),r.a.createElement("td",{style:{width:"10%"}},r.a.createElement(b.a,{onClick:function(){return function(e){fetch("api/buy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemid:e.itemId,username:t})}).then((function(e){200===e.status?alert("Successful. Waiting for seller approval now."):alert("Item is not available.")}))}(e)},disabled:!t},"Buy now")))}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(S.a,{fluid:"lg",className:"my-5"},t?r.a.createElement(b.a,{as:i.b,to:"/create",className:"mb-3"},"Create new listing"):"",g?0!==o.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{hover:!0},r.a.createElement("thead",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Price"),r.a.createElement("th",null,"Seller"),r.a.createElement("th",null)),r.a.createElement("tbody",null,N)),1!==p?r.a.createElement(b.a,{onClick:function(){return O(p-1)},className:"mr-3"},"Previous"):"",p!==Math.ceil(o.length/20)?r.a.createElement(b.a,{onClick:function(){return O(p+1)}},"Next"):""):r.a.createElement("p",{className:"loading-spinner"},"No item for you. Sad."):r.a.createElement(C.a,{animation:"border",variant:"primary",className:"loading-spinner"})))},I=a(133),P=a(365),k=a(368),T=function(e){var t=e.username,a=Object(n.useState)("orders"),l=Object(s.a)(a,2),c=l[0],o=l[1],m=Object(n.useState)([]),i=Object(s.a)(m,2),d=i[0],p=i[1];Object(n.useEffect)((function(){fetch("api/user/"+t).then((function(e){return e.json()})).then((function(e){p(e)}))}),[t]);var E;return r.a.createElement(r.a.Fragment,null,r.a.createElement(P.a,{className:"mt-5"},r.a.createElement(u.a,{md:{span:2,offset:1}},r.a.createElement(k.a,{variant:"pills",defaultActiveKey:"orders",className:"flex-column",onSelect:function(e){return o(e)}},r.a.createElement(k.a.Item,null,r.a.createElement(k.a.Link,{eventKey:"orders"},"Requests")),r.a.createElement(k.a.Item,null,r.a.createElement(k.a.Link,{eventKey:"password"},"Change password")))),r.a.createElement(u.a,{md:{span:6},className:"ml-5"},"password"===c?r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Change password"),r.a.createElement(f.a,{onSubmit:function(e){e.preventDefault(),e.stopPropagation();var a=new FormData(e.target);""!==a.get("password").trim()?fetch("api/user/password",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,password:Object(h.SHA256)(t+":"+a.get("password")).toString()})}).then((function(e){200===e.status?alert("Password changed successfully!"):alert("An error has occured! Please try again.")})):alert("Please enter a valid password")}},r.a.createElement(f.a.Group,{controlId:"name"},r.a.createElement(f.a.Label,null,"Username"),r.a.createElement(f.a.Control,{type:"text",placeholder:"Enter your name",defaultValue:t,disabled:!0})),r.a.createElement(f.a.Group,{controlId:"password"},r.a.createElement(f.a.Label,null,"Password"),r.a.createElement(f.a.Control,{type:"password",placeholder:"Password",name:"password"})),r.a.createElement(b.a,{variant:"primary",type:"submit"},"Save changes"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Incoming Requests"),r.a.createElement(w.a,null,r.a.createElement("thead",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Price"),r.a.createElement("th",null,"Buyer"),r.a.createElement("th",null,"Status")),r.a.createElement("tbody",null,(E=d)&&E.map((function(e){return r.a.createElement("tr",{key:e.itemId},r.a.createElement("td",null,e.name),r.a.createElement("td",null,"$",e.price),r.a.createElement("td",null,e.buyerName),r.a.createElement("td",null,r.a.createElement(b.a,{onClick:function(){return function(e){fetch("api/user/approve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,itemid:e.itemId})}).then((function(t){if(200===t.status){alert("Successful");var a=d.findIndex((function(t){return t.itemId===e.itemId}));p([].concat(Object(I.a)(d.slice(0,a)),Object(I.a)(d.slice(a+1))))}else alert("An error has occured.")}))}(e)}},"Approve")))}))))))))},x=function(e){var t=e.username,a=Object(n.useState)({}),l=Object(s.a)(a,2),c=l[0],o=l[1],u=Object(n.useState)(!1),i=Object(s.a)(u,2),E=i[0],h=i[1],g=Object(m.e)();return r.a.createElement(S.a,{fluid:"md",className:"mt-4"},r.a.createElement("h2",null,"Create new listing"),r.a.createElement(f.a,{onChange:function(e){"price"===e.target.name?o(Object(p.a)({},c,Object(d.a)({},e.target.name,parseInt(e.target.value)))):o(Object(p.a)({},c,Object(d.a)({},e.target.name,e.target.value)))},onSubmit:function(e){e.preventDefault(),e.stopPropagation(),e.currentTarget.checkValidity()&&(h(!0),fetch("api/sell",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(p.a)({},c,{username:t}))}).then((function(e){200===e.status?(alert("Successful"),g.push("/")):alert("An error has occured."),h(!1)})))}},r.a.createElement(f.a.Group,{controlId:"name"},r.a.createElement(f.a.Label,null,"Title"),r.a.createElement(f.a.Control,{type:"text",name:"name",required:!0})),r.a.createElement(f.a.Group,{controlId:"price"},r.a.createElement(f.a.Label,null,"Price"),r.a.createElement(f.a.Control,{type:"number",name:"price",required:!0})),r.a.createElement(f.a.Group,{controlId:"description"},r.a.createElement(f.a.Label,null,"Description"),r.a.createElement(f.a.Control,{as:"textarea",rows:5,name:"description",required:!0})),r.a.createElement(b.a,{type:"submit",disabled:E},"Submit")))};new FormData;var L=function(e){var t=e.username,a=(e.send,Object(m.f)());return r.a.createElement(O.a,{className:"p-0"},t&&r.a.createElement(O.a,null,r.a.createElement(m.a,{path:"/user"},r.a.createElement(T,{username:t})),r.a.createElement(m.a,{path:"/create"},r.a.createElement(x,{username:t}))),a.state?r.a.createElement(N,{username:t,searchitems:a.state}):r.a.createElement(m.a,{path:"/",exact:!0},r.a.createElement(N,{username:t})))},U=a(100),q=a(198),A=a.n(q),D=a(199),F=a.n(D);var J=function(){var e=Object(U.useToasts)().addToast,t=Object(n.useState)(null),a=Object(s.a)(t,2),l=a[0],c=a[1];return Object(n.useEffect)((function(){var e=sessionStorage.getItem("username");e!==l&&c(e)}),[]),Object(n.useEffect)((function(){var t=new A.a("/push_notif"),a=F.a.over(t);return a.debug=function(){},a.connect({},(function(){a.subscribe("/topic/messages",(function(t){var a=JSON.parse(t.body);console.log(a),e(a.user+" just requested to buy "+a.item+"!",{appearance:"info"})}))})),function(){a.disconnect()}}),[e]),r.a.createElement(i.a,{basename:""},r.a.createElement(y,{username:l,updateUser:function(e){sessionStorage.setItem("username",e),c(e)}}),r.a.createElement(L,{username:l}))};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(U.ToastProvider,{placement:"top-center",autoDismiss:!0},r.a.createElement(J,null))),document.getElementById("root"))}},[[203,1,2]]]);
//# sourceMappingURL=main.51a91d80.chunk.js.map